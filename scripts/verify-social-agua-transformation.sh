#!/bin/bash

# üåä SCRIPT DE VERIFICACI√ìN: TRANSFORMACI√ìN M√ìDULO SOCIAL AL ELEMENTO AGUA
# ==========================================================================
# PROMPT #077 - Ajuste Final del Plan Maestro Material UI
# Fecha: 17 de Junio 2025

echo "üåä VERIFICANDO TRANSFORMACI√ìN DEL M√ìDULO SOCIAL AL ELEMENTO AGUA"
echo "================================================================="

# üéØ Colores para output
GREEN='\033[0;32m'
BLUE='\033[0;34m'
YELLOW='\033[1;33m'
RED='\033[0;31m'
CYAN='\033[0;36m'
NC='\033[0m' # No Color

# üîç Funci√≥n para verificar contenido de archivo
check_file_content() {
    local file="$1"
    local pattern="$2"
    local description="$3"
    
    if [ -f "$file" ]; then
        if grep -q "$pattern" "$file"; then
            echo -e "  ${GREEN}‚úÖ${NC} $description"
            return 0
        else
            echo -e "  ${RED}‚ùå${NC} $description - Patr√≥n no encontrado"
            return 1
        fi
    else
        echo -e "  ${RED}‚ùå${NC} $description - Archivo no encontrado: $file"
        return 1
    fi
}

# üéØ Funci√≥n para verificar AUSENCIA de contenido (elemento anterior)
check_file_absence() {
    local file="$1"
    local pattern="$2"
    local description="$3"
    
    if [ -f "$file" ]; then
        if ! grep -q "$pattern" "$file"; then
            echo -e "  ${GREEN}‚úÖ${NC} $description"
            return 0
        else
            echo -e "  ${YELLOW}‚ö†Ô∏è${NC} $description - Patr√≥n anterior a√∫n presente"
            return 1
        fi
    else
        echo -e "  ${RED}‚ùå${NC} $description - Archivo no encontrado: $file"
        return 1
    fi
}

echo -e "\n${CYAN}üåä PARTE 1: VERIFICACI√ìN DE SOCIALMAIN.tsx CON ELEMENTO AGUA${NC}"
echo "============================================================="

# Verificar elemento agua en lugar de aire
check_file_content \
    "Demo/apps/superapp-unified/src/components/modules/social/SocialMain.tsx" \
    'element="agua"' \
    "Elemento 'agua' configurado correctamente"

# Verificar que NO quede elemento aire
check_file_absence \
    "Demo/apps/superapp-unified/src/components/modules/social/SocialMain.tsx" \
    'element="aire"' \
    "Elemento 'aire' anterior eliminado"

# Verificar t√≠tulo actualizado con emoji de agua
check_file_content \
    "Demo/apps/superapp-unified/src/components/modules/social/SocialMain.tsx" \
    'title="üåä Conexiones Coom√únity"' \
    "T√≠tulo actualizado con emoji de agua"

# Verificar efectos de part√≠culas acu√°ticas
check_file_content \
    "Demo/apps/superapp-unified/src/components/modules/social/SocialMain.tsx" \
    'particleTheme: .waterRipples.' \
    "Efectos de part√≠culas 'waterRipples' configurados"

# Verificar intensidad ajustada para agua
check_file_content \
    "Demo/apps/superapp-unified/src/components/modules/social/SocialMain.tsx" \
    'glowIntensity: 0.7' \
    "Intensidad de brillo ajustada para tema agua"

# Verificar comentario descriptivo actualizado
check_file_content \
    "Demo/apps/superapp-unified/src/components/modules/social/SocialMain.tsx" \
    'fluidez, conexi√≥n y profundidad emocional' \
    "Comentario descriptivo del elemento agua"

echo -e "\n${CYAN}üåä PARTE 2: VERIFICACI√ìN DE POSTCARD.tsx CON ELEMENTO AGUA${NC}"
echo "==========================================================="

# Verificar elemento agua en PostCard
check_file_content \
    "Demo/apps/superapp-unified/src/components/modules/social/components/PostCard.tsx" \
    'element="agua"' \
    "Elemento 'agua' configurado en PostCard"

# Verificar que NO quede elemento aire en PostCard
check_file_absence \
    "Demo/apps/superapp-unified/src/components/modules/social/components/PostCard.tsx" \
    'element="aire"' \
    "Elemento 'aire' anterior eliminado de PostCard"

# Verificar comentario descriptivo en PostCard
check_file_content \
    "Demo/apps/superapp-unified/src/components/modules/social/components/PostCard.tsx" \
    'fluidez y conexi√≥n emocional' \
    "Comentario descriptivo del agua en PostCard"

echo -e "\n${CYAN}üåä PARTE 3: VERIFICACI√ìN DE IMPORTS Y DEPENDENCIES${NC}"
echo "=================================================="

# Verificar import del RevolutionaryWidget
check_file_content \
    "Demo/apps/superapp-unified/src/components/modules/social/SocialMain.tsx" \
    "import { RevolutionaryWidget }" \
    "Import del RevolutionaryWidget presente"

# Verificar import del CosmicCard
check_file_content \
    "Demo/apps/superapp-unified/src/components/modules/social/components/PostCard.tsx" \
    "import { CosmicCard }" \
    "Import del CosmicCard presente"

echo -e "\n${CYAN}üåä PARTE 4: VERIFICACI√ìN DE SERVICIOS ACTIVOS${NC}"
echo "=============================================="

# Verificar que la SuperApp est√© funcionando
echo -n "  üåê Verificando SuperApp en puerto 3001... "
SUPERAPP_STATUS=$(curl -s -o /dev/null -w "%{http_code}" http://localhost:2222 2>/dev/null)
if [ "$SUPERAPP_STATUS" = "200" ]; then
    echo -e "${GREEN}‚úÖ SuperApp activa (HTTP $SUPERAPP_STATUS)${NC}"
else
    echo -e "${YELLOW}‚ö†Ô∏è SuperApp no responde o en puerto diferente (HTTP $SUPERAPP_STATUS)${NC}"
fi

# Verificar acceso espec√≠fico a la p√°gina social
echo -n "  ü§ù Verificando p√°gina Social... "
SOCIAL_STATUS=$(curl -s -o /dev/null -w "%{http_code}" http://localhost:2222/social 2>/dev/null)
if [ "$SOCIAL_STATUS" = "200" ]; then
    echo -e "${GREEN}‚úÖ P√°gina Social accesible (HTTP $SOCIAL_STATUS)${NC}"
else
    echo -e "${YELLOW}‚ö†Ô∏è P√°gina Social no accesible (HTTP $SOCIAL_STATUS)${NC}"
fi

echo -e "\n${CYAN}üåä PARTE 5: VERIFICACI√ìN DE DOCUMENTACI√ìN${NC}"
echo "=========================================="

# Verificar que existe la documentaci√≥n actualizada
check_file_content \
    "docs/implementation/SOCIAL_DESIGN_SYSTEM_TRANSFORMATION_SUMMARY.md" \
    "ELEMENTO AGUA" \
    "Documentaci√≥n actualizada con elemento agua"

# Verificar que el script de verificaci√≥n existe
if [ -f "scripts/verify-social-agua-transformation.sh" ]; then
    echo -e "  ${GREEN}‚úÖ${NC} Script de verificaci√≥n creado"
else
    echo -e "  ${YELLOW}‚ö†Ô∏è${NC} Script de verificaci√≥n no encontrado"
fi

echo -e "\n${CYAN}üåä PARTE 6: RESUMEN DE CRITERIOS DE ACEPTACI√ìN${NC}"
echo "=============================================="

# Contador de criterios cumplidos
criterios_cumplidos=0
total_criterios=8

echo -e "\n${BLUE}üìã Criterios de Aceptaci√≥n del PROMPT #077:${NC}"

# Criterio 1: Elemento agua aplicado
if grep -q 'element="agua"' "Demo/apps/superapp-unified/src/components/modules/social/SocialMain.tsx"; then
    echo -e "  ${GREEN}‚úÖ${NC} SocialMain usa elemento 'agua'"
    ((criterios_cumplidos++))
else
    echo -e "  ${RED}‚ùå${NC} SocialMain NO usa elemento 'agua'"
fi

# Criterio 2: PostCard con elemento agua
if grep -q 'element="agua"' "Demo/apps/superapp-unified/src/components/modules/social/components/PostCard.tsx"; then
    echo -e "  ${GREEN}‚úÖ${NC} PostCard usa elemento 'agua'"
    ((criterios_cumplidos++))
else
    echo -e "  ${RED}‚ùå${NC} PostCard NO usa elemento 'agua'"
fi

# Criterio 3: Efectos de part√≠culas acu√°ticas
if grep -q 'waterRipples' "Demo/apps/superapp-unified/src/components/modules/social/SocialMain.tsx"; then
    echo -e "  ${GREEN}‚úÖ${NC} Efectos de part√≠culas acu√°ticas configurados"
    ((criterios_cumplidos++))
else
    echo -e "  ${RED}‚ùå${NC} Efectos de part√≠culas acu√°ticas NO configurados"
fi

# Criterio 4: T√≠tulo actualizado
if grep -q 'üåä Conexiones Coom√únity' "Demo/apps/superapp-unified/src/components/modules/social/SocialMain.tsx"; then
    echo -e "  ${GREEN}‚úÖ${NC} T√≠tulo actualizado con emoji de agua"
    ((criterios_cumplidos++))
else
    echo -e "  ${RED}‚ùå${NC} T√≠tulo NO actualizado"
fi

# Criterio 5: Eliminaci√≥n elemento aire
if ! grep -q 'element="aire"' "Demo/apps/superapp-unified/src/components/modules/social/SocialMain.tsx"; then
    echo -e "  ${GREEN}‚úÖ${NC} Elemento 'aire' eliminado de SocialMain"
    ((criterios_cumplidos++))
else
    echo -e "  ${RED}‚ùå${NC} Elemento 'aire' A√öN presente en SocialMain"
fi

# Criterio 6: Eliminaci√≥n elemento aire en PostCard
if ! grep -q 'element="aire"' "Demo/apps/superapp-unified/src/components/modules/social/components/PostCard.tsx"; then
    echo -e "  ${GREEN}‚úÖ${NC} Elemento 'aire' eliminado de PostCard"
    ((criterios_cumplidos++))
else
    echo -e "  ${RED}‚ùå${NC} Elemento 'aire' A√öN presente en PostCard"
fi

# Criterio 7: Servicios funcionando
if [ "$SUPERAPP_STATUS" = "200" ] && [ "$SOCIAL_STATUS" = "200" ]; then
    echo -e "  ${GREEN}‚úÖ${NC} Servicios de SuperApp funcionando correctamente"
    ((criterios_cumplidos++))
else
    echo -e "  ${YELLOW}‚ö†Ô∏è${NC} Algunos servicios no est√°n completamente activos"
fi

# Criterio 8: Documentaci√≥n actualizada
if grep -q "ELEMENTO AGUA" "docs/implementation/SOCIAL_DESIGN_SYSTEM_TRANSFORMATION_SUMMARY.md" 2>/dev/null; then
    echo -e "  ${GREEN}‚úÖ${NC} Documentaci√≥n actualizada"
    ((criterios_cumplidos++))
else
    echo -e "  ${YELLOW}‚ö†Ô∏è${NC} Documentaci√≥n pendiente de actualizaci√≥n"
fi

# C√°lculo de porcentaje de √©xito
porcentaje_exito=$((criterios_cumplidos * 100 / total_criterios))

echo -e "\n${CYAN}üèÜ RESULTADO FINAL${NC}"
echo "=================="
echo -e "${BLUE}Criterios cumplidos:${NC} $criterios_cumplidos de $total_criterios"
echo -e "${BLUE}Porcentaje de √©xito:${NC} $porcentaje_exito%"

if [ $criterios_cumplidos -eq $total_criterios ]; then
    echo -e "\n${GREEN}üéâ ¬°TRANSFORMACI√ìN AL ELEMENTO AGUA COMPLETADA EXITOSAMENTE!${NC}"
    echo -e "${GREEN}üåä El m√≥dulo Social ahora refleja perfectamente la fluidez y conexi√≥n emocional${NC}"
    echo -e "${GREEN}üéØ 100% alineado con las especificaciones del Plan Maestro Material UI${NC}"
elif [ $criterios_cumplidos -ge 6 ]; then
    echo -e "\n${YELLOW}‚ö†Ô∏è TRANSFORMACI√ìN MAYORMENTE COMPLETADA${NC}"
    echo -e "${YELLOW}üîß Revisar criterios faltantes para completar la implementaci√≥n${NC}"
else
    echo -e "\n${RED}‚ùå TRANSFORMACI√ìN INCOMPLETA${NC}"
    echo -e "${RED}üîß Se requieren correcciones adicionales${NC}"
fi

echo -e "\n${CYAN}üìã PR√ìXIMOS PASOS SEG√öN PLAN MAESTRO:${NC}"
echo "1. üé¨ √úPlay Module - Elemento 'fuego' para energ√≠a y creatividad"
echo "2. üõçÔ∏è Marketplace Module - Elemento 'tierra' para estabilidad"
echo "3. üîó Cross-Module Integration - Navegaci√≥n c√≥smica unificada"

echo -e "\n${CYAN}üåä Verificaci√≥n completada - Elemento Agua aplicado al M√≥dulo Social${NC}"
echo "======================================================================" 