var settingsViewsWizard = {
    "search":{
        "tutorial":[
            {
                "element": ".btn-search",
                "title": "",
                "description": "Puedes buscar por nombre, usuario o palabras clave.",
                "position": "left-bottom"
            },
            {
                "element": ".btn-notifications",
                "title": "",
                "description": "Aquí verás tus notificaciones. Los íconos que ayudarán a identificar fácilmente cada una de ellas.",
                "position": "left-bottom"
            },
            {
                "element": ".parent-hexa.active",
                "title": "",
                "description": "También puedes explorar servicios, experiencias y productos a través de las categorías.",
                "position": "bottom"
            },
            {
                "element": "#primary-float",
                "title": "",
                "description": "Presiona aquí para abrir el Menú.",
                "position": "bottom-left"
            }
        ]
    },
    "user_profile":{
        "landscape": true,
        "tutorial":[
            {
                "element": ".role-customer",
                "title": "",
                "description": "Ser Emprendedor en CoomÜnity es un privilegio que puede ser tuyo. Espera muy pronto una convocatoria.",
                "position": "right-bottom"
            },
            {
                "element": "#lukas-menu",
                "title": "",
                "description": "Crea tu Wället y activa tus 50 Lükas de regalo.",
                "position": "right-bottom"
            },
            {
                "element": "#lukas-menu",
                "title": "",
                "description": "Siempre podrás abrir tu Wället haciendo clic aquí.",
                "position": "right-bottom"
            },
            {
                "element": ".btn-match",
                "title": "",
                "description": "Aquí encuentras todos los Matches (acuerdos) que has hecho con Emprendedöres.",
                "position": "bottom"
            },
            {
                "element": ".btn-anun",
                "title": "",
                "description": "Aquí encuentras los servicios, experiencias y productos que te han recomendado.",
                "position": "bottom"
            },
            {
                "element": ".btn-help-2",
                "title": "",
                "description": "¿Necesitas ayuda? Haz clic aquí.",
                "position": "top"
            },
            {
                "element": "#primary-float",
                "title": "",
                "description": "Haz clic aquí para volver a la pantalla inicial.",
                "position": "bottom-left"
            }
        ]
    },
    "user_profile":{
        "portrait": true,
        "tutorial":[
            {
                "element": ".role-customer",
                "title": "",
                "description": "Ser Emprendedor en CoomÜnity es un privilegio que puede ser tuyo. Espera muy pronto una convocatoria.",
                "position": "right-bottom"
            },
            {
                "element": "#lukas-menu",
                "title": "",
                "description": "Crea tu Wället y activa tus 50 Lükas de regalo.",
                "position": "right-bottom"
            },
            {
                "element": "#lukas-menu",
                "title": "",
                "description": "Siempre podrás abrir tu Wället haciendo clic aquí.",
                "position": "right-bottom"
            },
            {
                "element": ".btn-match",
                "title": "",
                "description": "Aquí encuentras todos los Matches (acuerdos) que has hecho con Emprendedöres.",
                "position": "bottom"
            },
            {
                "element": ".btn-anun",
                "title": "",
                "description": "Aquí encuentras los servicios, experiencias y productos que te han recomendado.",
                "position": "bottom"
            },
            {
                "element": ".btn-help-2",
                "title": "",
                "description": "¿Necesitas ayuda? Haz clic aquí.",
                "position": "top"
            },
            {
                "element": "#primary-float",
                "title": "",
                "description": "Haz clic aquí para volver a la pantalla inicial.",
                "position": "bottom-left"
            }
        ]
    },
    "wallet":{
        "tutorial":[
            {
                "element": ".navbar-item svg",
                "title": "",
                "description": "Haz clic aquí para volver a la pantalla inicial.",
                "position": "right"
            },
            {
                "element": "#lukas-wallet",
                "title": "",
                "description": "Este es tu saldo.",
                "position": "bottom"
            },
            {
                "element": "#reload_wallet",
                "title": "",
                "description": "Haz clic aquí para ir a comprar Lükas.",
                "position": "top-mid"
            },
            {
                "element": "#see-more-wallet",
                "title": "",
                "description": "Haz clic aquí para ver más movimientos.",
                "position": "top-right"
            },
            {
                "element": "#title-wallet",
                "title": "",
                "description": "Estos son los últimos movimientos de tus Lükas.",
                "position": "top-left"
            }
        ]
    },
    "pqrs":{
        "tutorial":[
            {
                "element": "#headingOne",
                "title": " ",
                "description": "Haz clic para ver más información de tu tema.",
                "position": "bottom"
            },
            {
                "element": "#back-pqrs",
                "title": "",
                "description": "Haz clic aquí para volver a la pantalla inicial.",
                "position": "top-left"
            },
            {
                "element": "#send-pqrs",
                "title": "",
                "description": "Haz clic aquí para hacer una consulta específica.",
                "position": "top-right"
            }
        ],
        "tutorial-1":[
            {
                "element": "#headingOne",
                "title": "",
                "description": "Haz clic para ver más información de tu tema.",
                "position": "bottom-mid"
            },
            {
                "element": "#back-pqrs",
                "title": "",
                "description": "Haz clic aquí para volver a la pantalla inicial.",
                "position": "bottom"
            },
            {
                "element": "#send-pqrs",
                "title": "",
                "description": "Haz clic aquí para hacer una consulta específica.",
                "position": "bottom-mid"
            }
        ]
    },
    "view":{
        "tutorial-customer":[
            {
                "element": ".navbar-item svg",
                "title": "",
                "description": "Haz clic aquí para volver a la pantalla inicial.",
                "position": "right"
            },
            {
                "element": "#iniciar-contacto",
                "title": "",
                "description": "Iniciar contacto y chatea con el Emprendedör, pregunta hasta comprender todo lo necesario.",
                "position": "top"
            },
            {
                "element": "#title-comentarios",
                "title": "",
                "description": "Estos son los comentarios de consumidores que han comprado a este Emprendedör.",
                "position": "top"
            }
        ],
        "tutorial-supplier-1":[
            {
                "element": ".navbar-item svg",
                "title": "",
                "description": "Haz clic aquí para volver a la pantalla inicial.",
                "position": "right"
            },
            {
                "element": "#inciar-contacto",
                "title": "",
                "description": "Iniciar contacto y chatea con el Emprendedör, pregunta hasta comprender todo lo necesario.",
                "position": "top"
            },
            {
                "element": "#recomendar",
                "title": "",
                "description": "Para poder recomendar tus servicios por fuera de nuestra Coomunidäd debes iniciar el proceso de Emprendedör.",
                "position": "top"
            },
            {
                "element": "#title-comentarios",
                "title": "",
                "description": "Estos son los comentarios de consumidores que han comprado a este Emprendedör.",
                "position": "top"
            }
        ],
        "tutorial-matches":[
            {
                "element": ".btn-chat",
                "title": "",
                "description": "Escríbele al  Emprendedör y obtén más información de su servicio.",
                "position": "top"
            },
            {
                "element": ".btn-acordar",
                "title": "",
                "description": "Haz clic aquí cuando todo esté listo para avanzar.",
                "position": "top"
            },
            {
                "element": ".btn-anular",
                "title": "",
                "description": "Cancela tu Match con el Emprendedör.",
                "position": "top"
            },
        ],
    },
    "go":{
        "tutorial-chat":[
            {
                "element": ".btn-back .icon",
                "title": "",
                "description": "Haz clic aquí para volver al Match.",
                "position": "right"
            },
            
        ],
    }
};

function createWizard( steps, position , preventScrolling = false){
    if(!(steps && steps != undefined)){
        return;
    }
    console.log("Steps: ", steps);
    window.tour = new Tour({
        padding: 0,
        next: 'Siguiente',
        done: 'Avanzar',
        prev: 'Anterior',
        tipClasses: 'tip-class active',
        steps: steps,
        preventScrolling: preventScrolling
    });    
    tour.override('showStep', function(self, step) {
      self(step);
    })
  
    tour.override('end', function(self, step) {
      self(step);
    })
    
    tour.start();
    /* var sizeObject = Object.keys(miObjeto[url]).length;
   
    if(sizeObject>0){
        miObjeto[url][position]= true;
    }else{
        miObjeto[url]= true;
    }
    
    localStorage.setItem('datos', JSON.stringify(miObjeto)); */

}

/* 
jQuery(document).ready(function(){
    showTourBySlug("tutorial");   
});

 */

function showTourBySlug(slug){
    var arrLocal = localStorage.getItem('datos');
    arrLocal = arrLocal ? arrLocal : "{}";

    var miObjeto = JSON.parse(arrLocal);
    var allUrl = window.location.href.split ("/");

    for (let index = 3; index < allUrl.length; index++) {
        var url = allUrl[index];
        url = url.split('?')[0];
        // Verificamos si la variable existe dentro del arreglo del local
        // Y si sí existe, verificamos si está en true la posición del tutorial actual
        // Esto nos devuelve true en caso de haberlo visto, pero necesitamos saber si no lo vió xd 

        if( miObjeto[url] == undefined || 
            (miObjeto[url][slug] != undefined && miObjeto[url][slug] != true) ||
            miObjeto[url][slug] == undefined
        ){
            var preventScrolling = false;
            // Verificamos si solo se muestra en horizontal (landscape así se dice xd)
            if(settingsViewsWizard[url] != undefined && settingsViewsWizard[url]['landscape'] != undefined && settingsViewsWizard[url]['landscape'] == true){
                // Si no está en landscape, que no muestre el tutorial.
                // Pero debemos dejar un disparador para que cuando gire el dispositivo se active solo
                if(window.innerHeight > window.innerWidth){
                    window.addEventListener("orientationchange", function() {
                        setTimeout(() => {
                            if(window.innerHeight < window.innerWidth){
                                showTourBySlug(slug);
                            }
                        }, 1000);
                    });

                    return;
                }else{
                    
                }
            }

            if(settingsViewsWizard[url] != undefined && settingsViewsWizard[url]['portrait'] != undefined && settingsViewsWizard[url]['portrait'] == true){
                // Si no está en portrait, que no muestre el tutorial.
                // Pero debemos dejar un disparador para que cuando gire el dispositivo se active solo
                if(window.innerHeight < window.innerWidth){
                    window.addEventListener("orientationchange", function() {
                        setTimeout(() => {
                            if(window.innerHeight > window.innerWidth){
                                showTourBySlug(slug);
                            }
                        }, 1000);
                    });

                    return;
                }else{
                    
                }
            }

            if(settingsViewsWizard[url] != undefined && settingsViewsWizard[url]['preventScrolling'] != undefined && settingsViewsWizard[url]['preventScrolling'] == true){
                preventScrolling = true;
            }

            // Entonces aquí ya sabemos si no lo ha visto:
            // Si no lo ha visto, verificamos que exista también en nuestro arreglo de tours
            //console.log("OBJ1: ", settingsViewsWizard[url]);
            if(settingsViewsWizard[url] != undefined){
                //console.log("OBJ2: ", settingsViewsWizard[url]);
                // Hasta aquí no debería de haber fallos, entonces lo que hacemos es asignar a true
                // la posición en el arreglo del localStorage

                // Aquí verificamos primero si existe el arreglo para esa url
                if(miObjeto[url] == undefined){
                    miObjeto[url] = {};
                    miObjeto[url][slug] = true;
                    //console.log(miObjeto);
                }else{
                    miObjeto[url][slug] = true;
                }

                localStorage.setItem('datos', JSON.stringify(miObjeto));

                setTimeout(() => {
                    /* console.log("Después del tiempo: ", miObjeto)
                    console.log("Después del tiempo: ", settingsViewsWizard[url]); */
                    if(settingsViewsWizard[url] == undefined){
                        return;
                    }                    
                    createWizard(settingsViewsWizard[url][slug], slug, preventScrolling );                    
                }, 500);


                break;
            }
        }
    }


    
}
