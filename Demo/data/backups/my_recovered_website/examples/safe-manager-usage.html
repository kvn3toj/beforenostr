<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ejemplo de Uso Seguro de Managers</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            line-height: 1.6;
        }
        .example-section {
            background: #f5f5f5;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
        }
        .code-block {
            background: #2d3748;
            color: #e2e8f0;
            padding: 15px;
            border-radius: 5px;
            font-family: 'Courier New', monospace;
            overflow-x: auto;
            margin: 10px 0;
        }
        .status-panel {
            background: #fff;
            border: 1px solid #ddd;
            border-radius: 5px;
            padding: 15px;
            margin: 10px 0;
        }
        button {
            background: #4299e1;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background: #3182ce;
        }
        .success { color: #38a169; }
        .error { color: #e53e3e; }
        .warning { color: #d69e2e; }
    </style>
</head>
<body>
    <h1>üõ°Ô∏è Sistema de Inicializaci√≥n Segura de Managers</h1>
    
    <div class="example-section">
        <h2>üìã Estado del Sistema</h2>
        <div id="status-panel" class="status-panel">
            <p>Cargando estado...</p>
        </div>
        <button onclick="updateStatus()">üîÑ Actualizar Estado</button>
        <button onclick="showDiagnostics()">üîç Mostrar Diagn√≥sticos</button>
    </div>

    <div class="example-section">
        <h2>1. ‚ùå Forma INCORRECTA (puede fallar)</h2>
        <div class="code-block">
// Esto puede fallar si el manager no est√° listo:
window.errorPreventionManager.enableAutoSave();
window.helpDocumentationManager.showBasicHints();
        </div>
        <button onclick="unsafeCall()">‚ùå Probar Llamada No Segura</button>
    </div>

    <div class="example-section">
        <h2>2. ‚úÖ Forma CORRECTA usando safeCall() - Con Promise</h2>
        <div class="code-block">
// Forma segura con Promise:
safeCall('errorPreventionManager', 'enableAutoSave', {
    interval: 15000,
    debugMode: true
}).then(result => {
    console.log('Auto-save enabled:', result);
}).catch(error => {
    console.error('Error:', error);
});
        </div>
        <button onclick="safeCallWithPromise()">‚úÖ Probar Llamada Segura (Promise)</button>
    </div>

    <div class="example-section">
        <h2>3. ‚úÖ Forma CORRECTA usando safeTryCall() - Directo</h2>
        <div class="code-block">
// Forma segura directa (silenciosa si no est√° listo):
safeTryCall('helpDocumentationManager', 'showBasicHints');
safeTryCall('visualHierarchyManager', 'updateHierarchyUI');
        </div>
        <button onclick="safeTryCallDirect()">‚úÖ Probar Llamada Directa Segura</button>
    </div>

    <div class="example-section">
        <h2>4. ‚úÖ Usando onReady callback</h2>
        <div class="code-block">
// Ejecutar cuando todos los managers est√©n listos:
window.managerInit.onReady(() => {
    console.log('Todos los managers est√°n listos!');
    // Realizar inicializaci√≥n segura aqu√≠
});
        </div>
        <button onclick="setupOnReadyCallback()">‚úÖ Configurar Callback OnReady</button>
    </div>

    <div class="example-section">
        <h2>5. üîß Ejemplo de Configuraci√≥n Avanzada</h2>
        <div class="code-block">
// Configuraci√≥n avanzada del autoguardado:
const autoSaveConfig = {
    interval: 20000,        // 20 segundos
    includeAllForms: true,  // Incluir todos los formularios
    showIndicator: true,    // Mostrar indicador
    excludeSelectors: ['.no-autosave'], // Excluir formularios
    debugMode: true,        // Modo debug
    onAutoSave: (data) => {
        console.log('Form auto-saved:', data);
    }
};

safeCall('errorPreventionManager', 'enableAutoSave', autoSaveConfig);
        </div>
        <button onclick="advancedAutoSaveConfig()">üîß Configurar AutoSave Avanzado</button>
    </div>

    <div class="example-section">
        <h2>6. üìä Monitoreo y Diagn√≥sticos</h2>
        <div id="diagnostics-panel" class="status-panel">
            <p>Haz clic en "Mostrar Diagn√≥sticos" para ver el estado detallado.</p>
        </div>
    </div>

    <!-- Simulador de formulario para pruebas -->
    <div class="example-section">
        <h2>üß™ Formulario de Prueba</h2>
        <form id="test-form" data-autosave>
            <div>
                <label for="test-input">Campo de prueba:</label>
                <input type="text" id="test-input" name="testField" placeholder="Escribe algo aqu√≠...">
            </div>
            <div>
                <label for="test-textarea">√Årea de texto:</label>
                <textarea id="test-textarea" name="testTextarea" placeholder="M√°s contenido..."></textarea>
            </div>
            <button type="submit">Enviar</button>
        </form>
    </div>

    <!-- Scripts del sistema -->
    <script src="../shared/js/manager-initialization.js"></script>
    <script src="../shared/js/error-prevention-manager.js"></script>
    <script src="../shared/js/help-documentation-manager.js"></script>
    
    <script>
        // ================================================
        // FUNCIONES DE DEMOSTRACI√ìN
        // ================================================

        function updateStatus() {
            const statusPanel = document.getElementById('status-panel');
            
            if (window.managerInit) {
                const status = window.managerInit.getStatus();
                let html = `
                    <h4>Estado del Sistema:</h4>
                    <p><strong>Sistema Listo:</strong> <span class="${status.isReady ? 'success' : 'warning'}">${status.isReady ? '‚úÖ S√≠' : '‚è≥ No'}</span></p>
                    <p><strong>Llamadas Pendientes:</strong> ${status.pendingCalls}</p>
                    <h5>Managers:</h5>
                    <ul>
                `;
                
                Object.entries(status.managers).forEach(([name, info]) => {
                    html += `
                        <li>
                            <strong>${name}:</strong> 
                            <span class="${info.isReady ? 'success' : 'warning'}">
                                ${info.isReady ? '‚úÖ Listo' : '‚è≥ Esperando'}
                            </span>
                            ${info.hasInstance ? '(Instancia disponible)' : ''}
                        </li>
                    `;
                });
                
                html += '</ul>';
                statusPanel.innerHTML = html;
            } else {
                statusPanel.innerHTML = '<p class="error">‚ùå Sistema de inicializaci√≥n no disponible</p>';
            }
        }

        function showDiagnostics() {
            const diagnosticsPanel = document.getElementById('diagnostics-panel');
            
            if (window.managerInit) {
                const status = window.managerInit.getStatus();
                diagnosticsPanel.innerHTML = `
                    <h4>üîç Diagn√≥sticos Detallados:</h4>
                    <div class="code-block">
                        ${JSON.stringify(status, null, 2)}
                    </div>
                `;
            } else {
                diagnosticsPanel.innerHTML = '<p class="error">‚ùå Sistema no disponible para diagn√≥sticos</p>';
            }
        }

        function unsafeCall() {
            try {
                // Intento directo - puede fallar
                if (window.errorPreventionManager && window.errorPreventionManager.enableAutoSave) {
                    window.errorPreventionManager.enableAutoSave();
                    console.log('‚úÖ Llamada directa exitosa');
                } else {
                    throw new Error('Manager o m√©todo no disponible');
                }
            } catch (error) {
                console.error('‚ùå Error en llamada directa:', error.message);
                alert('‚ùå Error: ' + error.message);
            }
        }

        function safeCallWithPromise() {
            safeCall('errorPreventionManager', 'enableAutoSave', {
                interval: 15000,
                debugMode: true,
                showIndicator: true
            }).then(result => {
                console.log('‚úÖ Auto-save habilitado de forma segura:', result);
                alert('‚úÖ Auto-save habilitado exitosamente!');
            }).catch(error => {
                console.error('‚ùå Error en llamada segura:', error);
                alert('‚ùå Error: ' + error.message);
            });
        }

        function safeTryCallDirect() {
            // Llamadas directas que fallan silenciosamente si no est√°n listas
            const result1 = safeTryCall('helpDocumentationManager', 'showBasicHints');
            const result2 = safeTryCall('visualHierarchyManager', 'updateHierarchyUI');
            
            console.log('üîÑ Intentos de llamadas directas completados');
            console.log('Resultado showBasicHints:', result1);
            console.log('Resultado updateHierarchyUI:', result2);
            
            alert('üîÑ Llamadas directas intentadas (revisa la consola)');
        }

        function setupOnReadyCallback() {
            window.managerInit.onReady(() => {
                console.log('üéâ Callback OnReady ejecutado - Todos los managers est√°n listos!');
                
                // Ahora podemos hacer llamadas seguras
                safeTryCall('helpDocumentationManager', 'showBasicHints');
                
                alert('üéâ Callback OnReady configurado y ejecutado!');
            });
            
            console.log('‚è≥ Callback OnReady registrado');
        }

        function advancedAutoSaveConfig() {
            const config = {
                interval: 20000,
                includeAllForms: true,
                showIndicator: true,
                excludeSelectors: ['.no-autosave'],
                debugMode: true,
                onAutoSave: (data) => {
                    console.log('üìù Form auto-saved:', data);
                }
            };

            safeCall('errorPreventionManager', 'enableAutoSave', config)
                .then(result => {
                    console.log('üîß Configuraci√≥n avanzada aplicada:', result);
                    alert('üîß Configuraci√≥n avanzada aplicada exitosamente!');
                })
                .catch(error => {
                    console.error('‚ùå Error en configuraci√≥n avanzada:', error);
                    alert('‚ùå Error: ' + error.message);
                });
        }

        // ================================================
        // INICIALIZACI√ìN
        // ================================================

        // Actualizar estado cada 2 segundos
        setInterval(updateStatus, 2000);
        
        // Actualizaci√≥n inicial
        setTimeout(updateStatus, 500);
        
        // Escuchar evento de managers listos
        window.addEventListener('managersReady', (event) => {
            console.log('üéâ Evento managersReady recibido:', event.detail);
            updateStatus();
        });

        // Log de inicio
        console.log('üì± P√°gina de ejemplo cargada');
        console.log('üí° Abre la consola del navegador para ver los logs detallados');
    </script>
</body>
</html> 