<!DOCTYPE html><html><head>

	<meta charset="UTF-8">		
	<meta name="viewport" content="width=device-width">
	<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

	<link rel="icon" type="image/png" href="https://coomunity.co/place//assets/plugins/chat/img/chat.png">

	<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css">
	<link rel="stylesheet" href="https://coomunity.co/place//assets/plugins/chat/css/fonts.css?v=1748924688">
	<link rel="stylesheet" href="https://coomunity.co/place//assets/plugins/emojis/css/emoji.css?v=1748924688">

	<link rel="stylesheet" type="text/css" href="https://coomunity.co/place/assets/plugins/chat/css/style.css?v=1748924688">
	<link rel="stylesheet" type="text/css" href="https://coomunity.co/place/assets/plugins/chat/css/style-responsive.css?v=1748924688">

	<link rel="stylesheet" type="text/css" href="https://coomunity.co/place/assets/v0.2/css/tour.min.css?v=0.0.1">

	<script src="https://coomunity.co/place/assets/plugins/chat/js/font-awesome.js"></script><link href="https://kit-free.fontawesome.com/releases/latest/css/free-v4-shims.min.css" media="all" rel="stylesheet"><link href="https://kit-free.fontawesome.com/releases/latest/css/free-v4-font-face.min.css" media="all" rel="stylesheet"><link href="https://kit-free.fontawesome.com/releases/latest/css/free.min.css" media="all" rel="stylesheet">

	<style>
		.btn-chat {
			border: none;
			background: #DC1A5B;
		}
		.user-status-discussion {
			background-color: #DC1A5B;
		}
		.d-message li:hover i,
		a i.fa-chevron-left{
			color: #DC1A5B;
		}
		.coo-loading {
			position: fixed;
			top: 0;
			left: 0;
			z-index: 99;
			width: 100%;
			height: 100%;
			display: flex;
			justify-content: center;
			align-items: center;
			background: #0000009c;
			flex-direction: column;
		}
		.last-message {
			clear: both;
			width: 100%;
		}
		div#discussion-block {
			padding-bottom: 50px;
		}
		.no-shown .fa-check-double {
			display: none;
		}
		.shown .fa-check {
			display: none;
		}
	</style>

</head>
<body>		
	
	<div class="container-fluid wrapper-chat">
		<div class="row">		
			<div class="col-12 d-lg-block d-md-block wrapper-discussion">
				<div class="row">

					<div class="col-lg-12 col-md-12 discussion-header">
					<div class="row">
						<div class="col-lg-4 col-12 discussion">
							<div class="row">
								<div class="col-lg-1 col-md-1 col-1 d-flex align-items-center btn-back">
									<a class="mt-3" href="https://coomunity.co/place//matches/view/38000e9aad777d56"><span class="icon"><i class="fas fa-chevron-left" aria-hidden="true"></i></span></a>
								</div>
								<div class="col-lg-2 col-md-3 col-2">
									<div class="user-status-discussion" style="display:none;"></div>
									<img src="https://coomunity.co/assets/img/avatar.jpg" alt="profile">
								</div>
							<div class="col-lg-9 col-md-8 col-8 contact-infos discussion-infos d-flex align-items-center">
								<h3 class="mt-0 ml-1">Juan Manuel Escobar Ram√≠rez</h3>
								<!--< p class="m-0">Online</p> -->
							</div>
						</div>
						</div>
					</div>
					</div>

					<div class="col-lg-12 col-md-12 discussion-list">
						<div class="row" id="discussion-block"></div>
					</div>

					<div class="col-lg-12 col-md-12 discussion-message">
						<ul class="d-message">
							<li class="message-block">
								<input type="text" class="input-message" name="messages" placeholder="Escribe un mensaje..." data-emojiable="converted" data-emoji-input="unicode" data-id="2e9320b7-1a0d-46f6-abce-7853dac993b0" data-type="original-input" style="display: none;"><div class="emoji-wysiwyg-editor input-message" data-id="2e9320b7-1a0d-46f6-abce-7853dac993b0" data-type="input" placeholder="Escribe un mensaje..." contenteditable="true" style="height: 26px;"></div><div class="emoji-menu" data-id="2e9320b7-1a0d-46f6-abce-7853dac993b0" data-type="menu" style="display: none;"><div class="emoji-items-wrap1"><table class="emoji-menu-tabs"><tbody><tr><td><a class="emoji-menu-tab icon-recent-selected"></a></td><td><a class="emoji-menu-tab icon-smile"></a></td><td><a class="emoji-menu-tab icon-flower"></a></td><td><a class="emoji-menu-tab icon-bell"></a></td><td><a class="emoji-menu-tab icon-car"></a></td><td><a class="emoji-menu-tab icon-grid"></a></td></tr></tbody></table><div class="emoji-items-wrap mobile_scrollable_wrap"><div class="emoji-items"><a href="javascript:void(0)" title=":joy:"><img src="https://coomunity.co/place/assets/plugins/emojis/img//blank.gif" class="img" style="display:inline-block;width:25px;height:25px;background:url('https://coomunity.co/place/assets/plugins/emojis/img//emoji_spritesheet_0.png') -550px 0px no-repeat;background-size:675px 175px;" alt=":joy:"><span class="label">:joy:</span></a><a href="javascript:void(0)" title=":kissing_heart:"><img src="https://coomunity.co/place/assets/plugins/emojis/img//blank.gif" class="img" style="display:inline-block;width:25px;height:25px;background:url('https://coomunity.co/place/assets/plugins/emojis/img//emoji_spritesheet_0.png') -175px 0px no-repeat;background-size:675px 175px;" alt=":kissing_heart:"><span class="label">:kissing_heart:</span></a><a href="javascript:void(0)" title=":heart:"><img src="https://coomunity.co/place/assets/plugins/emojis/img//blank.gif" class="img" style="display:inline-block;width:25px;height:25px;background:url('https://coomunity.co/place/assets/plugins/emojis/img//emoji_spritesheet_0.png') -250px -150px no-repeat;background-size:675px 175px;" alt=":heart:"><span class="label">:heart:</span></a><a href="javascript:void(0)" title=":heart_eyes:"><img src="https://coomunity.co/place/assets/plugins/emojis/img//blank.gif" class="img" style="display:inline-block;width:25px;height:25px;background:url('https://coomunity.co/place/assets/plugins/emojis/img//emoji_spritesheet_0.png') -150px 0px no-repeat;background-size:675px 175px;" alt=":heart_eyes:"><span class="label">:heart_eyes:</span></a><a href="javascript:void(0)" title=":blush:"><img src="https://coomunity.co/place/assets/plugins/emojis/img//blank.gif" class="img" style="display:inline-block;width:25px;height:25px;background:url('https://coomunity.co/place/assets/plugins/emojis/img//emoji_spritesheet_0.png') -75px 0px no-repeat;background-size:675px 175px;" alt=":blush:"><span class="label">:blush:</span></a><a href="javascript:void(0)" title=":grin:"><img src="https://coomunity.co/place/assets/plugins/emojis/img//blank.gif" class="img" style="display:inline-block;width:25px;height:25px;background:url('https://coomunity.co/place/assets/plugins/emojis/img//emoji_spritesheet_0.png') -375px 0px no-repeat;background-size:675px 175px;" alt=":grin:"><span class="label">:grin:</span></a><a href="javascript:void(0)" title=":+1:"><img src="https://coomunity.co/place/assets/plugins/emojis/img//blank.gif" class="img" style="display:inline-block;width:25px;height:25px;background:url('https://coomunity.co/place/assets/plugins/emojis/img//emoji_spritesheet_0.png') -600px -75px no-repeat;background-size:675px 175px;" alt=":+1:"><span class="label">:+1:</span></a><a href="javascript:void(0)" title=":relaxed:"><img src="https://coomunity.co/place/assets/plugins/emojis/img//blank.gif" class="img" style="display:inline-block;width:25px;height:25px;background:url('https://coomunity.co/place/assets/plugins/emojis/img//emoji_spritesheet_0.png') -100px 0px no-repeat;background-size:675px 175px;" alt=":relaxed:"><span class="label">:relaxed:</span></a><a href="javascript:void(0)" title=":pensive:"><img src="https://coomunity.co/place/assets/plugins/emojis/img//blank.gif" class="img" style="display:inline-block;width:25px;height:25px;background:url('https://coomunity.co/place/assets/plugins/emojis/img//emoji_spritesheet_0.png') -400px 0px no-repeat;background-size:675px 175px;" alt=":pensive:"><span class="label">:pensive:</span></a><a href="javascript:void(0)" title=":smile:"><img src="https://coomunity.co/place/assets/plugins/emojis/img//blank.gif" class="img" style="display:inline-block;width:25px;height:25px;background:url('https://coomunity.co/place/assets/plugins/emojis/img//emoji_spritesheet_0.png') 0px 0px no-repeat;background-size:675px 175px;" alt=":smile:"><span class="label">:smile:</span></a><a href="javascript:void(0)" title=":sob:"><img src="https://coomunity.co/place/assets/plugins/emojis/img//blank.gif" class="img" style="display:inline-block;width:25px;height:25px;background:url('https://coomunity.co/place/assets/plugins/emojis/img//emoji_spritesheet_0.png') -575px 0px no-repeat;background-size:675px 175px;" alt=":sob:"><span class="label">:sob:</span></a><a href="javascript:void(0)" title=":kiss:"><img src="https://coomunity.co/place/assets/plugins/emojis/img//blank.gif" class="img" style="display:inline-block;width:25px;height:25px;background:url('https://coomunity.co/place/assets/plugins/emojis/img//emoji_spritesheet_0.png') -475px -150px no-repeat;background-size:675px 175px;" alt=":kiss:"><span class="label">:kiss:</span></a><a href="javascript:void(0)" title=":unamused:"><img src="https://coomunity.co/place/assets/plugins/emojis/img//blank.gif" class="img" style="display:inline-block;width:25px;height:25px;background:url('https://coomunity.co/place/assets/plugins/emojis/img//emoji_spritesheet_0.png') -450px 0px no-repeat;background-size:675px 175px;" alt=":unamused:"><span class="label">:unamused:</span></a><a href="javascript:void(0)" title=":flushed:"><img src="https://coomunity.co/place/assets/plugins/emojis/img//blank.gif" class="img" style="display:inline-block;width:25px;height:25px;background:url('https://coomunity.co/place/assets/plugins/emojis/img//emoji_spritesheet_0.png') -350px 0px no-repeat;background-size:675px 175px;" alt=":flushed:"><span class="label">:flushed:</span></a><a href="javascript:void(0)" title=":stuck_out_tongue_winking_eye:"><img src="https://coomunity.co/place/assets/plugins/emojis/img//blank.gif" class="img" style="display:inline-block;width:25px;height:25px;background:url('https://coomunity.co/place/assets/plugins/emojis/img//emoji_spritesheet_0.png') -275px 0px no-repeat;background-size:675px 175px;" alt=":stuck_out_tongue_winking_eye:"><span class="label">:stuck_out_tongue_winking_eye:</span></a><a href="javascript:void(0)" title=":see_no_evil:"><img src="https://coomunity.co/place/assets/plugins/emojis/img//blank.gif" class="img" style="display:inline-block;width:25px;height:25px;background:url('https://coomunity.co/place/assets/plugins/emojis/img//emoji_spritesheet_0.png') -75px -75px no-repeat;background-size:675px 175px;" alt=":see_no_evil:"><span class="label">:see_no_evil:</span></a><a href="javascript:void(0)" title=":wink:"><img src="https://coomunity.co/place/assets/plugins/emojis/img//blank.gif" class="img" style="display:inline-block;width:25px;height:25px;background:url('https://coomunity.co/place/assets/plugins/emojis/img//emoji_spritesheet_0.png') -125px 0px no-repeat;background-size:675px 175px;" alt=":wink:"><span class="label">:wink:</span></a><a href="javascript:void(0)" title=":smiley:"><img src="https://coomunity.co/place/assets/plugins/emojis/img//blank.gif" class="img" style="display:inline-block;width:25px;height:25px;background:url('https://coomunity.co/place/assets/plugins/emojis/img//emoji_spritesheet_0.png') -25px 0px no-repeat;background-size:675px 175px;" alt=":smiley:"><span class="label">:smiley:</span></a><a href="javascript:void(0)" title=":cry:"><img src="https://coomunity.co/place/assets/plugins/emojis/img//blank.gif" class="img" style="display:inline-block;width:25px;height:25px;background:url('https://coomunity.co/place/assets/plugins/emojis/img//emoji_spritesheet_0.png') -525px 0px no-repeat;background-size:675px 175px;" alt=":cry:"><span class="label">:cry:</span></a><a href="javascript:void(0)" title=":stuck_out_tongue_closed_eyes:"><img src="https://coomunity.co/place/assets/plugins/emojis/img//blank.gif" class="img" style="display:inline-block;width:25px;height:25px;background:url('https://coomunity.co/place/assets/plugins/emojis/img//emoji_spritesheet_0.png') -300px 0px no-repeat;background-size:675px 175px;" alt=":stuck_out_tongue_closed_eyes:"><span class="label">:stuck_out_tongue_closed_eyes:</span></a><a href="javascript:void(0)" title=":scream:"><img src="https://coomunity.co/place/assets/plugins/emojis/img//blank.gif" class="img" style="display:inline-block;width:25px;height:25px;background:url('https://coomunity.co/place/assets/plugins/emojis/img//emoji_spritesheet_0.png') -125px -25px no-repeat;background-size:675px 175px;" alt=":scream:"><span class="label">:scream:</span></a><a href="javascript:void(0)" title=":rage:"><img src="https://coomunity.co/place/assets/plugins/emojis/img//blank.gif" class="img" style="display:inline-block;width:25px;height:25px;background:url('https://coomunity.co/place/assets/plugins/emojis/img//emoji_spritesheet_0.png') -175px -25px no-repeat;background-size:675px 175px;" alt=":rage:"><span class="label">:rage:</span></a><a href="javascript:void(0)" title=":smirk:"><img src="https://coomunity.co/place/assets/plugins/emojis/img//blank.gif" class="img" style="display:inline-block;width:25px;height:25px;background:url('https://coomunity.co/place/assets/plugins/emojis/img//emoji_spritesheet_0.png') -50px -50px no-repeat;background-size:675px 175px;" alt=":smirk:"><span class="label">:smirk:</span></a><a href="javascript:void(0)" title=":disappointed:"><img src="https://coomunity.co/place/assets/plugins/emojis/img//blank.gif" class="img" style="display:inline-block;width:25px;height:25px;background:url('https://coomunity.co/place/assets/plugins/emojis/img//emoji_spritesheet_0.png') -475px 0px no-repeat;background-size:675px 175px;" alt=":disappointed:"><span class="label">:disappointed:</span></a><a href="javascript:void(0)" title=":sweat_smile:"><img src="https://coomunity.co/place/assets/plugins/emojis/img//blank.gif" class="img" style="display:inline-block;width:25px;height:25px;background:url('https://coomunity.co/place/assets/plugins/emojis/img//emoji_spritesheet_0.png') 0px -25px no-repeat;background-size:675px 175px;" alt=":sweat_smile:"><span class="label">:sweat_smile:</span></a><a href="javascript:void(0)" title=":kissing_closed_eyes:"><img src="https://coomunity.co/place/assets/plugins/emojis/img//blank.gif" class="img" style="display:inline-block;width:25px;height:25px;background:url('https://coomunity.co/place/assets/plugins/emojis/img//emoji_spritesheet_0.png') -200px 0px no-repeat;background-size:675px 175px;" alt=":kissing_closed_eyes:"><span class="label">:kissing_closed_eyes:</span></a><a href="javascript:void(0)" title=":speak_no_evil:"><img src="https://coomunity.co/place/assets/plugins/emojis/img//blank.gif" class="img" style="display:inline-block;width:25px;height:25px;background:url('https://coomunity.co/place/assets/plugins/emojis/img//emoji_spritesheet_0.png') -125px -75px no-repeat;background-size:675px 175px;" alt=":speak_no_evil:"><span class="label">:speak_no_evil:</span></a><a href="javascript:void(0)" title=":relieved:"><img src="https://coomunity.co/place/assets/plugins/emojis/img//blank.gif" class="img" style="display:inline-block;width:25px;height:25px;background:url('https://coomunity.co/place/assets/plugins/emojis/img//emoji_spritesheet_0.png') -425px 0px no-repeat;background-size:675px 175px;" alt=":relieved:"><span class="label">:relieved:</span></a><a href="javascript:void(0)" title=":grinning:"><img src="https://coomunity.co/place/assets/plugins/emojis/img//blank.gif" class="img" style="display:inline-block;width:25px;height:25px;background:url('https://coomunity.co/place/assets/plugins/emojis/img//emoji_spritesheet_0.png') -50px 0px no-repeat;background-size:675px 175px;" alt=":grinning:"><span class="label">:grinning:</span></a><a href="javascript:void(0)" title=":yum:"><img src="https://coomunity.co/place/assets/plugins/emojis/img//blank.gif" class="img" style="display:inline-block;width:25px;height:25px;background:url('https://coomunity.co/place/assets/plugins/emojis/img//emoji_spritesheet_0.png') -275px -25px no-repeat;background-size:675px 175px;" alt=":yum:"><span class="label">:yum:</span></a><a href="javascript:void(0)" title=":ok_hand:"><img src="https://coomunity.co/place/assets/plugins/emojis/img//blank.gif" class="img" style="display:inline-block;width:25px;height:25px;background:url('https://coomunity.co/place/assets/plugins/emojis/img//emoji_spritesheet_0.png') -650px -75px no-repeat;background-size:675px 175px;" alt=":ok_hand:"><span class="label">:ok_hand:</span></a><a href="javascript:void(0)" title=":neutral_face:"><img src="https://coomunity.co/place/assets/plugins/emojis/img//blank.gif" class="img" style="display:inline-block;width:25px;height:25px;background:url('https://coomunity.co/place/assets/plugins/emojis/img//emoji_spritesheet_0.png') -600px -25px no-repeat;background-size:675px 175px;" alt=":neutral_face:"><span class="label">:neutral_face:</span></a><a href="javascript:void(0)" title=":confused:"><img src="https://coomunity.co/place/assets/plugins/emojis/img//blank.gif" class="img" style="display:inline-block;width:25px;height:25px;background:url('https://coomunity.co/place/assets/plugins/emojis/img//emoji_spritesheet_0.png') -625px -25px no-repeat;background-size:675px 175px;" alt=":confused:"><span class="label">:confused:</span></a></div></div></div></div><i class="emoji-picker-icon emoji-picker fa fa-smile-o" data-id="2e9320b7-1a0d-46f6-abce-7853dac993b0" data-type="picker" aria-hidden="true"></i>
							</li>		
							<li class="cont-file-upload">
								<form>
									<input type="file" name="fileToUpload" id="fileToUpload" style="display: none;" accept=".jpg,.png,.gif,.jpeg">
									<i class="fas fa-paperclip" aria-hidden="true"></i>								
								</form>
							</li>
							<li class="send-msg">
								<button class="btn-msg btn-chat hide">
									<i class="far fa-paper-plane" aria-hidden="true"></i>
								</button>
								<button class="btn-audio btn-chat" id="recordButton">
									<i class="fa fa-microphone" aria-hidden="true"></i>
								</button>
								<button class="btn-stop btn-chat hide" id="stopButton">
									<i class="fa fa-stop" aria-hidden="true"></i>
								</button>
							</li>
						</ul>
					</div>

				</div>
			</div>
		</div>
	</div>

	
	<script src="https://chat.coomunity.co:8080/socket.io/socket.io.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
	<script>

		"use strict";

		var channel = "38000e9aad777d56";
		var user = "4f558d1a-793b-11ea-aa3f-005056bfd758";

		/* var chat = ;
		var lengthChat = chat.length; */
		var cont = 0;
		var scrollLastChild = false;
		/* chat.forEach( item => {
			if( item.user == user ) sendMessage( item.body, new Date( item.created ), false );
			else receiveMessage( item.body, new Date( item.created ) );
			if(cont<=lengthChat) scrollLastChild = true;
			cont++;
		} ); */
		

		var socket = io( "https://chat.coomunity.co:8080" );

		socket.on( "connect", function () {
			socket.emit( "join", { channel: channel, user: user } );
		} );

		socket.on( "message", function( data ) {
			if( data.user === user ) sendMessage( data, new Date, true );
			else receiveMessage( data, new Date );
		});

		var timerOnline = null;

		socket.on( "keep-alive", function( data ) {
			//console.log( "keep-alive", data );
			if(data.user != user){
				jQuery('.no-shown').addClass('shown').removeClass('no-shown');
				jQuery('.user-status-discussion').show();

				if (timerOnline) {
					clearTimeout(timerOnline);
					timerOnline = null;
				}

				timerOnline = setTimeout(() => {
					jQuery('.user-status-discussion').hide();
				}, 6000);
			}
		});

		setInterval( () => { socket.emit( "keep-alive", { channel: channel, user: user } ); }, 3000 );

		$('#send').click( function (e) { 

			e.preventDefault();
			$('#message').val('');
			return false;

		});

		/* $( "body" ).on( "keyup", ".message-block input", function (e) {
			if( $( ".message-block input" ).is( ":focus" ) && ( e.keyCode == 13 ) )
				check_n_send();
		} ); */

		$( "body" ).on( "click", ".send-msg", function() {
			check_n_send();
		} );

		function check_n_send()
		{
			var body = $( ".message-block input" ).val();
			if( body != "" )
			{
				socket.emit( "message", { channel: channel, user: user, body: body, type: 'text' } );
				$( ".message-block input" ).val( "" );
				$( ".emoji-wysiwyg-editor" ).empty();
				$('.emoji-wysiwyg-editor').height(26);
			}
		}

		function formatAMPM( date )
		{
			var hours = date.getHours();
			var minutes = date.getMinutes();
			var day = date.getDate();
			var month = date.getMonth();
			var ampm = hours >= 12 ? 'pm' : 'am';
			hours = hours % 12;
			hours = hours ? hours : 12; // the hour '0' should be '12'
			minutes = minutes < 10 ? '0'+minutes : minutes;
			var strTime = getMonth(month) + ' ' + day + ' ' + hours + ':' + minutes + ' ' + ampm;
			return strTime;
		}

		function getMonth(m){
			var months = [
				'Enero',
				'Febrero',
				'Marzo',
				'Abril',
				'Mayo',
				'Junio',
				'Julio',
				'Agosto',
				'Septiembre',
				'Octubre',
				'Noviembre',
				'Diciembre'
			];
			return months[m];
		}

		function sendMessage( item, created, activeScroll, type = "normal" )
		{
			console.log("Date: ", created.getDay());
			var time = formatAMPM( created );
			var body = item.body;
			var html = `
				<div class="col-lg-12 col-md-12 message-chat message-chat-right ${item.shown != null ? "shown" : "no-shown"}">
					<div class="message-chat-text">
						<span>${body}</span>
					</div>
					<div class="message-chat-meta">
						<span>${time}<i class="fas fa-check"></i><i class="fas fa-check-double"></i></span>
					</div>
				</div>
			`;

			if(item.type == 'recording'){
				html = `
					<div class="col-lg-12 col-md-12 message-chat message-chat-right ${item.shown != null ? "shown" : "no-shown"}">
						<div class="message-chat-text">
							<audio controls="">
								<source src="${item.body}" type="audio/wav">
							</audio>
						</div>
						<div class="message-chat-meta">
							<span>${time}<i class="fas fa-check"></i><i class="fas fa-check-double"></i></span>
						</div>
					</div>
				`;
			}else if(item.type == 'image'){
				html = `
					<div class="col-lg-12 col-md-12 message-chat message-chat-right ${item.shown != null ? "shown" : "no-shown"}">
						<div class="message-chat-text">
							<a href="${item.body}" data-fancybox="gallery" class="fancy-image">
								<img src="${item.body}">
							</a>
						</div>
						<div class="message-chat-meta">
							<span>${time}<i class="fas fa-check"></i><i class="fas fa-check-double"></i></span>
						</div>
					</div>
				`;
			}

			if(type == "normal"){
				$( "#discussion-block" ).append(html);
			}
			if(type == "prepend"){
				$( "#discussion-block" ).prepend(html);
			}
			/* var d = $( ".discussion-list" );
			d.animate( { scrollTop: d.prop( "scrollHeight" ) }, 1000 ); */
			
			if( activeScroll ) {
				var d = $( ".discussion-list" );
				d.animate( { scrollTop: d.prop( "scrollHeight" ) }, 1000 );
			}else if(scrollLastChild) {
				setTimeout(function() {
					var d = $( ".discussion-list" );
					d.animate( { scrollTop: $('#discussion-block').height()-20 }, 0 );
				}, 1000);
			
			}
				
		}

		function receiveMessage( item, created, type = "normal" )
		{
			console.log("Receive item: ", item);
			var body = item.body;
			var time = formatAMPM( created );
			var html = `
				<div class="col-lg-12 col-md-12 message-chat message-chat-left ${item.shown != null ? "shown" : "no-shown"}">
					<div class="message-chat-text">
						<span>${body}</span>
					</div>
					<div class="message-chat-meta">
						<span>${time}<!--<i class="fas fa-check"></i><i class="fas fa-check-double"></i>--></span>
					</div>
				</div>
			`;

			if(item.type == 'recording'){
				html = `
					<div class="col-lg-12 col-md-12 message-chat message-chat-left ${item.shown != null ? "shown" : "no-shown"}">
						<div class="message-chat-text">
							<audio controls="">
								<source src="${item.body}" type="audio/wav">
							</audio>
						</div>
						<div class="message-chat-meta">
							<span>${time}<!--<i class="fas fa-check"></i><i class="fas fa-check-double"></i>--></span>
						</div>
					</div>
				`;
			}else if(item.type == 'image'){
				html = `
					<div class="col-lg-12 col-md-12 message-chat message-chat-left ${item.shown != null ? "shown" : "no-shown"}">
						<div class="message-chat-text">
							<a href="${item.body}" data-fancybox="gallery" class="fancy-image">
								<img src="${item.body}">
							</a>
						</div>
						<div class="message-chat-meta">
							<span>${time}<!--<i class="fas fa-check"></i><i class="fas fa-check-double"></i>--></span>
						</div>
					</div>
				`;
			}
			if(type == "normal"){
				$( "#discussion-block" ).append(html);
			}
			if(type == "prepend"){
				$( "#discussion-block" ).prepend(html);
			}
			var d = $( ".discussion-list" );
			d.animate( { scrollTop: d.prop( "scrollHeight" ) }, 0 );
		}

		var loading_messages = false;
		var url_messages = 'https://coomunity.co/place/gossip/chat/';
		var last_message_id = 0;
		var before_message_id = 0;
		var nomore = false;

		function loadMoreMessage(type = "normal", first = false){
			// /place/gossip/chat/76950a54-7dbe-11ea-9274-005056bfd758/0
			
			if(!loading_messages && !nomore){
				var el = '.discussion-list';
				//showLoading(el);
				loading_messages = true;
				$.ajax({
					method: "GET",
					url: url_messages+""+channel+"/"+last_message_id,
				})
				.done(function( response ) {

					if(response.success == 'got-results'){

						before_message_id = last_message_id;

						// Add el to last-message
						var html = '<div class="last-message last-'+before_message_id+'"></div>';
						$( "#discussion-block" ).prepend(html);
						
						var messages = response.chat;

						if(type=="normal"){
							messages.reverse();
						}

						messages.forEach(function (item) {
							var nd = new Date( item.created * 1000 );
							//console.log("D√≠a: ", nd.getDay());
							if( item.user == user ){
								sendMessage( item, nd, false, type );
							}else {								
								receiveMessage( item, nd, type );
							}
						});
						
						
						
						last_message_id = response.last_message_id;

						if(type == "normal"){
							var d = $( ".discussion-list" );
							d.animate( { scrollTop: d.prop( "scrollHeight" ) }, 1000 );
						}else{
							if($('.last-'+before_message_id ).length > 0){
								$('.discussion-list').animate({
									scrollTop: $('.discussion-list').scrollTop() + $('.last-'+before_message_id ).next().position().top - 30
								}, 0);	
							}
						}
					}else if(response.success == 'eof'){
						nomore = true;
					}
					loading_messages = false;

					if(first){
						setTimeout(() => {
							var container_chat = '.discussion-list';
							$(container_chat).on('scroll', function() {
								var height = $(container_chat).scrollTop();
								if(height <= 1) {
									loadMoreMessage('prepend');
								}
							});
						}, 1000);
						
					}

					//hideLoading(el);
				})
				.fail(function(){
					//hideLoading(el)
					loading_messages = false;
				});

			}

		}

		jQuery(document).ready(function(){
			loadMoreMessage('normal', true);

			setTimeout(() => {
				jQuery('.emoji-wysiwyg-editor').click(function(){
					console.log('Click');
					var d = $( ".discussion-list" );
					d.animate( { scrollTop: d.prop( "scrollHeight" ) }, 1000 );
				});	
			}, 2000);
			

		});

		function showLoading(element){
			hideLoading(element);
			jQuery(element).append('<div class="coo-loading"><img src="/assets/img/cp/cp_loading.svg"></div>')
		}

		function hideLoading(element){
			jQuery(element).children(".coo-loading").remove();
		}

	</script>

	<script src="https://coomunity.co/place/assets/plugins/emojis/js/config.js?v=1748924688"></script>
	<script src="https://coomunity.co/place/assets/plugins/emojis/js/util.js?v=1748924688"></script>
	<script src="https://coomunity.co/place/assets/plugins/emojis/js/jquery.emojiarea.js?v=1748924688"></script>
	<script src="https://coomunity.co/place/assets/plugins/emojis/js/emoji-picker.js?v=1748924688"></script>
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.css">
	<script src="https://cdn.jsdelivr.net/gh/fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.js"></script>
	
	<script type="text/javascript" src="https://coomunity.co/place//assets/v0.2/js/tour.min.js?v=1748924688"></script>
	<script type="text/javascript" src="https://coomunity.co/place//assets/v0.2/js/wizard.js?v=1748924688"></script>
	
	<script>

		$(function() {
			setTimeout(() => {

				// Initializes and creates emoji set from sprite sheet
				window.emojiPicker = new EmojiPicker({
					emojiable_selector: '.input-message',
					assetsPath: 'https://coomunity.co/place/assets/plugins/emojis/img/',
					popupButtonClasses: 'fa fa-smile-o'
				});
				// Finds all elements with `emojiable_selector` and converts them to rich emoji input fields
				// You may want to delay this step if you have dynamically created input fields that appear later in the loading process
				// It can be called as many times as necessary; previously converted input fields will not be converted again
				window.emojiPicker.discover();

				$('.emoji-wysiwyg-editor').height(26);

			}, 1000);

			

			jQuery('input[name=messages]').on('keyup change paste',function(e) {
				
				var single_height = 26;
				var max_lines = 3;

				var h = $('.emoji-wysiwyg-editor').prop('scrollHeight');

				if(h < (single_height * max_lines)){
					$('.emoji-wysiwyg-editor').height(h);
				}else{
					$('.emoji-wysiwyg-editor').height(single_height * max_lines);
				}
				onChangeMessage();
			});
			/* jQuery('input[name=messages]').on('change', function(e) {
				onChangeMessage();
			}); */
		});
		function onChangeMessage(){
			//var message = $('input[name=messages]').val();
			setTimeout(() => {
				var message = $('.emoji-wysiwyg-editor').text();
				if(message.length > 0){
					jQuery('.btn-msg').removeClass('hide');
					jQuery('.btn-audio').addClass('hide');
				}else{
					jQuery('.btn-msg').addClass('hide');
					jQuery('.btn-audio').removeClass('hide');
				}
			}, 10);
			//console.log("Message 2: ", $('input[name=messages]').val());

			

		}
		var url_audio = "https://coomunity.co/place/store/form"
	</script>
	<script>
		jQuery(document).ready(function(){

			showTourBySlug('tutorial-chat');

			$('.fa-paperclip').click(function(){
				console.log('Click');
				$('#fileToUpload').click();					
			});

			$().fancybox({
				selector : '.fancy-image'
			});

			document.getElementById("fileToUpload").addEventListener("change", function (event) {
				compress(event);
			});

		});
		function compress(e) {
			var width = 1000;
			
			const fileName = e.target.files[0].name;
			const reader = new FileReader();
			reader.readAsDataURL(e.target.files[0]);
			reader.onload = event => {
				const img = new Image();
				img.src = event.target.result;
				img.onload = () => {

					var height = (width * img.height) / img.width;

					const elem = document.createElement('canvas');
					elem.width = width;
					elem.height = height;
					const ctx = elem.getContext('2d');
					// img.width y img.height  contiene las dimensiones originales
					ctx.drawImage(img, 0, 0, width, height);
					ctx.canvas.toBlob((blob) => {
						const file = new File([blob], fileName, {
							type: 'image/jpeg',
							lastModified: Date.now()
						});

						var xhr=new XMLHttpRequest();
						xhr.overrideMimeType("application/json");
						xhr.onload=function(e) {
							var response = JSON.parse(xhr.responseText);

							if(typeof response.success === 'undefined'){
								alert('Ha ocurrido un error, int√©ntalo de nuevo');
							}else{
								var url = response.url;
								var item = {
									type: 'image',
									body: '',
									url: url
								}
								socket.emit( "message", { channel: channel, user: user, body: url, type: 'image' } );
								//sendMessage( item, new Date, true, 'normal' );
							}
						};
						var fd=new FormData();
						fd.append("file", blob, fileName);
						fd.append("source", fileName+".jpeg");
						fd.append("folder", 'chat');
						xhr.open("POST", url_audio, true);
						xhr.send(fd);


					}, 'image/jpeg', 0.6);
				},
				reader.onerror = error => console.log(error);
			};
		}
		
	</script>
	<script src="https://cdn.rawgit.com/mattdiamond/Recorderjs/08e7abd9/dist/recorder.js"></script>
	<script src="https://coomunity.co/place/assets/js/gossip/recoder.js?v=1748924688"></script>


<div class="ttour-shadow ttour-shadow-779"><div class="ttour-overlay" style="left: 15px; top: 24.5px; width: 10px; height: 22.5px;"><div class="ttour-wrapper"><div class="ttour-tip tip-0 right" style=""><div class="ttour-header"><h1></h1></div><div class="ttour-body">Haz clic aqu√≠ para volver al Match.</div><div class="ttour-footer"><div class="ttour-bullets"><div class="ttour-bullet active"></div></div><button class="next">Avanzar</button></div><div class="ttour-arrow"></div></div></div></div></div></body></html>