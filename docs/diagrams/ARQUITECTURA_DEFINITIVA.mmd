%% ARQUITECTURA DEFINITIVA COOMUNITY GLOBAL
%% VersiÃ³n: v2.0 - FINAL Y DEFINITIVA
%% Fecha: 2025-06-19
%% Estado: Backend NestJS 100% + Admin 100% + SuperApp 96%

graph TB
    subgraph "ğŸŒŸ ARQUITECTURA COOMUNITY GLOBAL - DEFINITIVA"
        direction TB

        subgraph "ğŸ’» BACKEND (COMPLETADO 100%)"
            direction TB
            B1["ğŸš€ Backend NestJS<br/>Puerto: 3002<br/>Estado: âœ… FUNCIONAL<br/>Stack: NestJS + TypeScript<br/>DB: PostgreSQL + Prisma"]
            B2["ğŸ—„ï¸ Base de Datos<br/>PostgreSQL + Prisma<br/>Estado: âœ… OPERATIVA<br/>RLS: âœ… IMPLEMENTADO"]
            B3["âš¡ Cache & Performance<br/>Redis Cache<br/>Estado: âœ… ACTIVA<br/>Monitoring: Prometheus"]
            B4["ğŸ” AutenticaciÃ³n<br/>JWT + RBAC<br/>Estado: âœ… IMPLEMENTADO<br/>Guards: âœ… FUNCIONALES"]

            B1 --- B2
            B1 --- B3
            B1 --- B4
        end

        subgraph "ğŸ›ï¸ FRONTEND ADMIN (COMPLETADO 100%)"
            direction TB
            A1["ğŸ® Gamifier Admin<br/>Puerto: 3000<br/>Estado: âœ… FUNCIONAL<br/>IntegraciÃ³n: âœ… BACKEND"]
            A2["ğŸ¨ UI Framework<br/>React + Material-UI<br/>Estado: âœ… IMPLEMENTADO<br/>Design System: âœ… ACTIVO"]
            A3["ğŸ“Š Funcionalidades<br/>CRUD Completo<br/>Estado: âœ… VERIFICADO<br/>Tests: âœ… PASANDO"]

            A1 --- A2
            A1 --- A3
        end

        subgraph "ğŸ“± FRONTEND SUPERAPP (95% COMPLETADO)"
            direction TB
            S1["ğŸŒ SuperApp CoomÃœnity<br/>Puerto: 3001<br/>Estado: ğŸ”„ DESARROLLO<br/>Directorio: apps/superapp-unified/"]
            S2["âš›ï¸ Core Framework<br/>React 18 + TypeScript<br/>Estado: âœ… CONFIGURADO<br/>Build: Vite 6.2.5"]
            S3["ğŸ¨ UI Components<br/>Material-UI v7 + Tailwind<br/>Estado: âœ… INSTALADO<br/>Conflicts: âœ… RESUELTOS"]
            S4["ğŸ”— State Management<br/>React Query + Zustand<br/>Estado: âœ… CONFIGURADO<br/>Router: React Router v6"]

            S1 --- S2
            S1 --- S3
            S1 --- S4
        end

        subgraph "ğŸ§ª TESTING (90% COMPLETADO)"
            direction TB
            T1["ğŸ­ E2E Testing<br/>Playwright 1.52.0<br/>Estado: âœ… FUNCIONAL<br/>UbicaciÃ³n: SuperApp Ãºnicamente"]
            T2["âš¡ Unit Testing<br/>Vitest + Jest<br/>Estado: âœ… CONFIGURADO<br/>Coverage: ğŸ”„ EN PROGRESO"]
            T3["ğŸ” Quality Assurance<br/>ESLint + Prettier<br/>Estado: âœ… CONFIGURADO<br/>CI/CD: ğŸ”„ PENDIENTE"]

            T1 --- T2
            T1 --- T3
        end

        subgraph "ğŸ“ WORKSPACE ESTRUCTURA"
            direction TB
            W1["ğŸ“‚ Directorio Principal<br/>apps/superapp-unified/<br/>Estado: âœ… ACTIVO<br/>Tipo: Monorepo"]
            W2["ğŸ“‹ ConfiguraciÃ³n IA<br/>Reglas Actualizadas<br/>Estado: âœ… DEFINIDAS<br/>Prompt: ACTUALIZADO"]
            W3["ğŸ“š DocumentaciÃ³n<br/>Arquitectura + GuÃ­as<br/>Estado: âœ… ACTUALIZADA<br/>Diagramas: âœ… SINCRONIZADOS"]

            W1 --- W2
            W1 --- W3
        end
    end

    subgraph "ğŸ”— INTEGRACIONES ACTIVAS"
        direction LR
        API1["ğŸ”Œ API REST Calls<br/>MÃ©todo: HTTP/HTTPS<br/>Formato: JSON"]
        API2["ğŸ« AutenticaciÃ³n<br/>JWT Tokens<br/>Refresh: AutomÃ¡tico"]
        API3["ğŸ“¡ ComunicaciÃ³n<br/>Port 3002 â†’ 3000/3001<br/>CORS: Configurado"]

        API1 --- API2
        API2 --- API3
    end

    subgraph "âŒ COMPONENTES DEPRECATED"
        direction TB
        X1["âŒ Supabase Integration<br/>RazÃ³n: Era mock temporal<br/>Reemplazo: Backend NestJS"]
        X2["âŒ Express Backend Mock<br/>RazÃ³n: Era temporal<br/>Puerto: 3000 (conflicto)"]
        X3["âŒ Dependencias Temporales<br/>@supabase/supabase-js<br/>Estado: A ELIMINAR"]

        X1 -.-> X2
        X2 -.-> X3
    end

    subgraph "ğŸ¯ PRÃ“XIMOS PASOS"
        direction TB
        N1["ğŸ”„ IntegraciÃ³n Final<br/>SuperApp â†” Backend NestJS<br/>Prioridad: ALTA"]
        N2["ğŸ§¹ Limpieza CÃ³digo<br/>Eliminar mocks temporales<br/>Prioridad: MEDIA"]
        N3["ğŸš€ Deployment<br/>Configurar producciÃ³n<br/>Prioridad: BAJA"]

        N1 --> N2
        N2 --> N3
    end

    %% Conexiones principales ACTUALES
    A1 -.->|"ğŸ”— API Integrada"| B1
    S1 -.->|"ğŸ”„ A INTEGRAR"| B1
    T1 -.->|"ğŸ§ª Tests SuperApp"| S1
    T1 -.->|"ğŸ§ª Tests Admin"| A1

    %% Flujo de desarrollo
    B1 -.->|"âœ… 100% FUNCIONAL"| A1
    S1 -.->|"ğŸ”„ 95% - INTEGRACIÃ“N PENDIENTE"| B1
    W2 -.->|"ğŸ“‹ GUÃA DESARROLLO"| S1

    %% Conexiones futuras
    N1 -.->|"ğŸ¯ OBJETIVO"| S1
    N2 -.->|"ğŸ§¹ LIMPIEZA"| S1

    classDef completed fill:#4CAF50,stroke:#2E7D32,color:#fff,stroke-width:3px
    classDef inprogress fill:#FF9800,stroke:#F57C00,color:#fff,stroke-width:2px
    classDef deprecated fill:#f44336,stroke:#c62828,color:#fff,stroke-width:2px
    classDef connection fill:#2196F3,stroke:#1976D2,color:#fff,stroke-width:2px
    classDef nextSteps fill:#9C27B0,stroke:#6A1B9A,color:#fff,stroke-width:2px

    class B1,B2,B3,B4,A1,A2,A3,T1,T2,W1,W2,W3 completed
    class S1,S2,S3,S4,T3 inprogress
    class X1,X2,X3 deprecated
    class API1,API2,API3 connection
    class N1,N2,N3 nextSteps